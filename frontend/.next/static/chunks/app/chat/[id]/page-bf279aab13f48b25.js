(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[877],{814:(e,t,a)=>{Promise.resolve().then(a.bind(a,1390))},6046:(e,t,a)=>{"use strict";var s=a(6658);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},1390:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var s=a(5155),r=a(2115),n=a(6046),i=a(4595),o=a(7819),c=a.n(o),l=a(4565);let u=(e,t)=>[e,t].sort().join("_"),d=e=>{try{let t=localStorage.getItem("chat_".concat(e));return t?JSON.parse(t):[]}catch(e){return console.error("Error loading messages:",e),[]}},m=(e,t)=>{try{localStorage.setItem("chat_".concat(e),JSON.stringify(t))}catch(e){console.error("Error storing messages:",e)}},p=["Which table are you at?","Can we meet in person?","Would you like to get coffee together?","Are you currently at the cafe?"];function h(){let e=(0,n.useRouter)(),t=(0,n.useParams)(),[a,o]=(0,r.useState)([]),[h,g]=(0,r.useState)(""),[_,f]=(0,r.useState)(null),[v,j]=(0,r.useState)(!1),N=(0,r.useRef)(null),y=(0,r.useRef)(null),[w,S]=(0,r.useState)(""),[b,x]=(0,r.useState)(!0),[k,E]=(0,r.useState)(null);(0,r.useEffect)(()=>{let a=i.j.currentUser;if(!a){e.push("/login");return}let s=t.id,r=u(a.uid,s);S(r),o(d(r))},[t.id,e]),(0,r.useEffect)(()=>{w&&a.length>0&&m(w,a)},[a,w]),(0,r.useEffect)(()=>{(async()=>{let a=i.j.currentUser;if(!a){e.push("/login");return}try{let e=await fetch("http://192.168.1.3:5000/api/auth/user/".concat(t.id));if(!e.ok)throw Error("Failed to fetch user");let s=await e.json();f(s.user);let r=await fetch("http://192.168.1.3:5000/api/chat/history/".concat(a.uid,"/").concat(t.id));if(!r.ok)throw Error("Failed to fetch chat history");let n=await r.json();o(n.messages),x(!1)}catch(e){console.error("Error:",e),E("Failed to load chat"),x(!1)}})()},[t.id,e]);let I=()=>{var e;null===(e=N.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{I()},[a]);let B=async()=>{if(h.trim()&&i.j.currentUser)try{let e={text:h.trim(),senderId:i.j.currentUser.uid,receiverId:t.id,timestamp:Date.now()},a=await fetch("http://192.168.1.3:5000/api/chat/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw Error("Failed to send message");let s=await a.json();o(e=>[...e,s.message]),g("")}catch(e){console.error("Error sending message:",e),E("Failed to send message")}},C=async()=>{try{var t;let a=null===(t=i.j.currentUser)||void 0===t?void 0:t.uid;if(!a)return;if(!(await fetch("http://192.168.1.3:5000/api/auth/sign-out",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a})})).ok)throw Error("Failed to update sign-out status");await (0,l.CI)(i.j),localStorage.clear(),e.push("/login")}catch(e){console.error("Error signing out:",e)}},O=async e=>{if(i.j.currentUser)try{var a;let s={id:Date.now().toString(),text:e,senderId:i.j.currentUser.uid,receiverId:t.id,timestamp:Date.now()};if(o(e=>[...e,s]),null===(a=N.current)||void 0===a||a.scrollIntoView({behavior:"smooth"}),!(await fetch("http://localhost:5000/api/chat/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw Error("Failed to send message")}catch(e){console.error("Error sending message:",e),E("Failed to send message")}};return b?(0,s.jsx)("div",{className:c().loading,children:"Loading chat..."}):(0,s.jsxs)("div",{className:c().container,children:[(0,s.jsx)("div",{className:c().overlay}),(0,s.jsxs)("header",{className:c().header,children:[(0,s.jsx)("button",{onClick:()=>e.back(),className:c().backButton,children:"← Back"}),(0,s.jsx)("div",{className:c().brandName,children:"BrewNet"}),(0,s.jsxs)("div",{className:c().profileMenu,children:[(0,s.jsx)("button",{onClick:()=>j(!v),className:c().profileButton,children:"My Profile"}),v&&(0,s.jsxs)("div",{className:c().menuDropdown,children:[(0,s.jsx)("div",{className:c().menuItem,onClick:()=>{var t;return e.push("/profile/".concat(null===(t=i.j.currentUser)||void 0===t?void 0:t.uid))},children:"View Profile"}),(0,s.jsx)("div",{className:c().menuItem,onClick:()=>e.push("/onboarding?update=true"),children:"Edit Profile"}),(0,s.jsx)("div",{className:"".concat(c().menuItem," ").concat(c().signOutButton),onClick:C,children:"Sign Out"})]})]})]}),(0,s.jsxs)("main",{className:c().chatContainer,children:[(0,s.jsx)("div",{className:c().chatHeader,children:(0,s.jsx)("h1",{className:c().userName,children:null==_?void 0:_.name})}),(0,s.jsxs)("div",{className:c().messageList,children:[a.map(e=>{var t;return(0,s.jsx)("div",{className:"".concat(c().messageWrapper," ").concat(e.senderId===(null===(t=i.j.currentUser)||void 0===t?void 0:t.uid)?c().sent:c().received),children:(0,s.jsx)("div",{className:c().message,children:(0,s.jsxs)("div",{className:c().messageContent,children:[e.text,(0,s.jsx)("span",{className:c().timestamp,children:new Date(e.timestamp).toLocaleTimeString()})]})})},e._id||e.timestamp.toString())}),(0,s.jsx)("div",{ref:N})]}),(0,s.jsx)("div",{className:c().quickMessages,children:p.map(e=>(0,s.jsx)("button",{onClick:()=>O(e),className:c().quickMessageButton,children:e},e))}),(0,s.jsxs)("div",{className:c().inputArea,children:[(0,s.jsx)("input",{ref:y,type:"text",value:h,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),B())},placeholder:"Type a message...",className:c().input}),(0,s.jsx)("button",{onClick:B,className:c().sendButton,disabled:!h.trim(),children:"Send"})]})]})]})}},4595:(e,t,a)=>{"use strict";a.d(t,{j:()=>i});var s=a(9904),r=a(4565);let n=(0,s.Wp)({apiKey:"AIzaSyD72HmBTrehu6RqAwfH14n37nbgSoSiF4c",authDomain:"brewnet-dd55e.firebaseapp.com",projectId:"brewnet-dd55e",storageBucket:"brewnet-dd55e.firebasestorage.app",messagingSenderId:"720864557324",appId:"1:720864557324:web:b7f4b2419dc12753503129"}),i=(0,r.xI)(n)},7819:e=>{e.exports={container:"page_container__YEDy3",overlay:"page_overlay__ybO8v",header:"page_header__nhlXx",backButton:"page_backButton__qWfSR",brandName:"page_brandName__1N8kS",chatContainer:"page_chatContainer__pESoN",chatHeader:"page_chatHeader__4VMpH",userName:"page_userName__G6sFG",messageList:"page_messageList__5BgJU",messageWrapper:"page_messageWrapper__tFNKR",sent:"page_sent__KeXfH",message:"page_message__e7c9v",fadeIn:"page_fadeIn__9bNQD",received:"page_received__bbHym",timestamp:"page_timestamp__LLUj_",readStatus:"page_readStatus__QCTBV",read:"page_read__9lQZg",inputArea:"page_inputArea__TYEXr",input:"page_input__uoVf1",sendButton:"page_sendButton___km8o",profileMenu:"page_profileMenu__WaX4Z",profileButton:"page_profileButton___InWu",menuDropdown:"page_menuDropdown__QovEl",slideDown:"page_slideDown__YQYQO",menuItem:"page_menuItem__viF6w",signOutButton:"page_signOutButton__vZOSH",quickMessages:"page_quickMessages__JgKD_",quickMessageButton:"page_quickMessageButton__jLq88"}}},e=>{var t=t=>e(e.s=t);e.O(0,[752,895,803,441,517,358],()=>t(814)),_N_E=e.O()}]);